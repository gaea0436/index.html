<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>華的東京獨旅 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6B8E9B;
            --primary-dark: #557582;
            --bg: #F9F7F5;
            --text: #5A5A5A;
            --text-light: #949494;
            --card-bg: #FFFFFF;
            --accent: #C5A087;
            --line: #E0E0E0;
            --bubble-border: #BCCCD1;
            --tag-transport: #DDE5E8;
            --tag-spot: #EAE4DC;      
            --tag-food: #EFEBE5;      
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            padding-bottom: 90px;
        }

        /* --- Header: 修正版面被切到的問題 --- */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px 20px 60px 20px; /* 增加下方 padding 給氣象區 */
            border-radius: 0 0 30px 30px;
            box-shadow: 0 10px 20px rgba(107, 142, 155, 0.25);
            position: relative;
            z-index: 100;
            overflow: visible; /* 關鍵：允許內容超出框框不被切掉 */
        }
        
        /* 標題與頭像容器 - 使用 Flexbox 避免跑版 */
        .title-area {
            display: flex;
            align-items: flex-start;
            justify-content: space-between; /* 標題左，圖右 */
            width: 100%;
        }
        
        #mainTitle {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 1.5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            line-height: 1.5;
            flex: 1; /* 佔據剩餘空間 */
            padding-right: 10px;
        }
        
        /* 修正：頭像大小與位置，確保不被切到 */
        .walking-icon-img {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.9);
            object-fit: cover;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            background: white; 
            flex-shrink: 0; /* 禁止被壓縮 */
        }

        .weather-widget {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
        }
        
        .temp-box p { margin: 0; font-size: 0.85rem; opacity: 0.9; font-weight: 400; margin-bottom: 2px;}
        .temp-box h1 { 
            margin: 0; 
            font-size: 1.3rem; 
            font-weight: 500; 
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .outfit-tip {
            background: rgba(255,255,255,0.25);
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 6px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.4);
            max-width: 60%;
        }

        /* --- 日期與行程 --- */
        .date-scroller {
            display: flex;
            overflow-x: auto;
            padding: 15px 15px;
            gap: 10px;
            scrollbar-width: none;
            background: var(--bg);
        }
        .date-chip {
            background: white;
            min-width: 65px;
            height: 65px;
            padding: 8px;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            border: 1px solid transparent;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            flex-shrink: 0;
        }
        .date-chip strong { font-size: 1.0rem; font-weight: 700; color: #C0C0C0; margin-bottom: 2px;}
        .date-chip span { font-size: 0.7rem; }
        .date-chip.active {
            background: white;
            border: 2px solid var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(107, 142, 155, 0.3);
        }
        .date-chip.active strong { color: var(--primary) !important; }
        .date-chip.active span { color: var(--primary) !important; font-weight: bold; }

        .timeline-container { padding: 10px 20px; }
        .timeline-item { display: flex; margin-bottom: 25px; position: relative; }
        .timeline-item::before {
            content: ''; position: absolute; left: 28px; top: 0; bottom: -25px; width: 2px; background: var(--line); z-index: 0;
        }
        .timeline-item:last-child::before { display: none; }

        .time-wrapper {
            width: 65px; flex-shrink: 0; display: flex; flex-direction: column; align-items: center; padding-top: 10px; z-index: 1; margin-right: 10px;
        }
        .time-bubble {
            background: white; color: var(--primary); border: 2px solid var(--bubble-border); border-radius: 20px; padding: 4px 8px; font-size: 0.75rem; font-weight: 700; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 2; text-align: center; min-width: 50px;
        }

        .content-col {
            flex: 1; background: var(--card-bg); border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); position: relative; z-index: 1; overflow: hidden; display: flex; flex-direction: row; min-height: 110px;
        }
        .card-img-col {
            width: 35%; min-width: 100px; position: relative; overflow: hidden; background-color: #eee;
        }
        .card-img {
            width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0;
        }
        .card-body { 
            flex: 1; padding: 12px 15px; display: flex; flex-direction: column; justify-content: center;
        }
        
        /* 標題與標題後的小圖 */
        .card-body h3 { 
            margin: 0 0 5px 0; 
            font-size: 1.05rem; 
            color: #4F5D64; 
            font-weight: 700; 
            line-height: 1.4;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        
        /* 修正需求 1：行程標題後的女性走路圖示 */
        .walk-icon-inline {
            height: 24px;
            width: auto;
            margin-left: 5px;
            display: inline-block;
            vertical-align: middle;
        }

        .tag {
            display: inline-block; font-size: 0.65rem; padding: 2px 6px; border-radius: 4px; color: #666; margin-bottom: 6px; font-weight: 500; width: fit-content;
        }
        .tag.交通 { background: var(--tag-transport); color: #546E7A; }
        .tag.景點 { background: var(--tag-spot); color: #8D7663; }
        .tag.餐飲 { background: var(--tag-food); color: #8A7E72; }
        .tag.住宿 { background: var(--secondary); color: #607D8B; }

        .note { font-size: 0.8rem; color: #888; margin-top: 5px; line-height: 1.4; }

        .nav-btn-corner {
            position: absolute; top: 10px; right: 10px; color: var(--primary); background: rgba(255,255,255,0.8); width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 5; text-decoration: none;
        }

        /* --- 底部與其他 --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -4px 20px rgba(0,0,0,0.05); z-index: 200; border-top-left-radius: 20px; border-top-right-radius: 20px;
        }
        .nav-item { text-align: center; color: #C0C0C0; font-size: 0.75rem; cursor: pointer; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 1.2rem; display: block; margin-bottom: 4px; }

        .page { display: none; padding-bottom: 20px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Tools */
        .tools-container { padding: 20px; }
        .tool-card { background: white; padding: 20px; border-radius: 16px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        .translate-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .phrase-btn { background: white; border: 1px solid var(--accent); color: var(--accent); padding: 15px 10px; border-radius: 12px; text-align: center; font-size: 0.9rem; cursor: pointer; transition: all 0.2s; }
        .phrase-btn:active { background: var(--accent); color: white; transform: scale(0.95); }
        .tool-btn { background: var(--accent); color: white; border: none; padding: 12px; width: 100%; border-radius: 10px; font-size: 1rem; margin-top: 10px; cursor: pointer; }

        /* Food */
        .food-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 15px; }
        .food-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        .real-food-img { width: 100%; height: 120px; object-fit: cover; }
        .food-info { padding: 12px; }

    </style>
</head>
<body>

    <div class="header" id="headerWidget">
        <div class="title-area">
            <h2 id="mainTitle">◈ 東京慢旅．只屬於我的日常 ◈</h2>
            <img src="https://images.unsplash.com/photo-1515463138280-67d1dcbf3175?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80" class="walking-icon-img" alt="Me">
        </div>
        <div class="weather-widget">
            <div class="temp-box">
                <p id="currentDateDisplay">2月3日 (二)</p>
                <h1 id="weatherTemp"></h1>
            </div>
            <div class="outfit-tip" id="weatherTip">
                <i class="fas fa-tshirt"></i> <span>請穿著洋蔥式穿搭</span>
            </div>
        </div>
    </div>

    <div class="date-scroller" id="dateNav"></div>

    <div id="page-itinerary" class="page active">
        <div class="timeline-container" id="itineraryList"></div>
    </div>

    <div id="page-food" class="page">
        <div class="food-grid" id="foodList"></div>
    </div>

    <div id="page-tools" class="page">
        <div class="tools-container">
            <div class="tool-card">
                <h3><i class="fas fa-volume-up"></i> 點擊說日文</h3>
                <p style="font-size:0.8rem; color:#999; margin-bottom:15px;">點擊即時發音 (請開啟手機聲音)</p>
                <div class="translate-grid">
                    <div class="phrase-btn" onclick="speak('すみません、トイレはどこですか？')">
                        <i class="fas fa-restroom"></i> 廁所在哪裡
                    </div>
                    <div class="phrase-btn" onclick="speak('これをください。')">
                        <i class="fas fa-hand-pointer"></i> 請給我這個
                    </div>
                    <div class="phrase-btn" onclick="speak('お会計をお願いします。')">
                        <i class="fas fa-wallet"></i> 麻煩結帳
                    </div>
                    <div class="phrase-btn" onclick="speak('袋はいりません。')">
                        <i class="fas fa-shopping-bag"></i> 不用袋子
                    </div>
                </div>
                <button class="tool-btn" style="background:var(--primary); margin-top:15px;" onclick="window.open('https://translate.google.com/?sl=zh-TW&tl=ja&op=translate')">
                    開啟 Google 翻譯
                </button>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchPage('itinerary', this)"><i class="fas fa-route"></i> 行程</div>
        <div class="nav-item" onclick="switchPage('food', this)"><i class="fas fa-cookie-bite"></i> 美食</div>
        <div class="nav-item" onclick="switchPage('tools', this)"><i class="fas fa-tools"></i> 工具</div>
    </div>

    <script>
        // --- 修正後的圖庫與資料 ---
        
        // 修正：使用 Unsplash Source API 取得高穩定度圖片，不再使用隨機連結
        const itineraryDB = {
            "D1 2026-02-03(二)": [
                // 這裡更換為機場的穩定圖源
                { time: "15:35", title: "桃園 T1 起飛 (IT202)", type: "交通", note: "機場先吃午餐。13:30 報到。", link: "", img: "https://images.unsplash.com/photo-1569154941061-e231b4725ef1?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" },
                { time: "19:35", title: "抵達成田 T2", type: "交通", note: "購買/儲值西瓜卡 (Suica)。", link: "", img: "https://images.unsplash.com/photo-1542296332-2e44a99cfef9?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" }, 
                { time: "21:45", title: "入住：四谷京阪飯店", type: "住宿", note: "四谷站步行3分。樓下有超市。", link: "", img: "https://images.unsplash.com/photo-1618773928121-c32242e63f39?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" }
            ],
            "D2 2026-02-04(三)": [
                { time: "09:30", title: "上野東照宮", type: "景點", note: "金碧輝煌江戶建築與牡丹花園。", link: "", img: "https://images.unsplash.com/photo-1605252873733-6627d35393c0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" }, 
                { time: "11:00", title: "伊豆榮 梅川亭", type: "餐飲", note: "百年鰻魚飯老店。", link: "", img: "https://images.unsplash.com/photo-1580442151529-343f2f6e0e27?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" },
                { time: "13:00", title: "淺草寺 & 雷門", type: "景點", note: "仲見世通吃人形燒。", link: "", img: "https://images.unsplash.com/photo-1536098561742-ca998e48cbcc?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" }
            ],
            "D3 2026-02-05(四)": [
                { time: "09:00", title: "皇居 (二重橋)", type: "景點", note: "必帶護照。欣賞護城河。", link: "", img: "https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" },
                { time: "15:00", title: "秋葉原尋寶", type: "購物", note: "無線電會館。", link: "", img: "https://images.unsplash.com/photo-1577949392182-1dc37fa70562?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" }
            ],
            "D4 2026-02-06(五)": [
                { time: "09:00", title: "明治神宮", type: "景點", note: "都市森林漫步。", link: "", img: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" },
                { time: "13:30", title: "新宿御苑", type: "景點", note: "庭園極美。", link: "", img: "https://images.unsplash.com/photo-1555547639-650228d7a12b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" }
            ],
            "D5 2026-02-07(六)": [
                { time: "10:30", title: "東京鐵塔", type: "景點", note: "芝公園拍照。", link: "", img: "https://images.unsplash.com/photo-1503899036084-c55cdd92da26?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" },
                { time: "17:30", title: "澀谷 Sky", type: "景點", note: "俯瞰東京全景。", link: "", img: "https://images.unsplash.com/photo-1542931287-023b922fa89b?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" }
            ],
            "D6 2026-02-08(日)": [
                { time: "09:15", title: "成田機場", type: "交通", note: "準備返家。", link: "", img: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" }
            ]
        };

        const weatherDB = {
            "2026-02-03": { temp: "5-11°", icon: "cloud-sun", tip: "搭機日，建議洋蔥式穿搭。" },
            "2026-02-04": { temp: "3-9°", icon: "sun", tip: "戶外多，穿羽絨衣。" },
            "2026-02-05": { temp: "2-8°", icon: "snowflake", tip: "氣溫轉冷，戴毛帽。" },
            "2026-02-06": { temp: "4-10°", icon: "cloud", tip: "市區逛街，舒適為主。" },
            "2026-02-07": { temp: "5-12°", icon: "sun", tip: "天氣回暖，適合拍照。" },
            "2026-02-08": { temp: "6-13°", icon: "plane", tip: "返程日，輕便為主。" }
        };

        const foodDB = [
            { name: "FamiChiki 炸雞", price: "¥240", shop: "FamilyMart", img: "https://images.unsplash.com/photo-1562967960-f55430ae51e8?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" },
            { name: "炸雞君", price: "¥258", shop: "Lawson", img: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" },
            { name: "關東煮", price: "¥120", shop: "7-11", img: "https://images.unsplash.com/photo-1534422298391-e4f8c172dddb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" },
             { name: "超商甜點", price: "¥350", shop: "All", img: "https://images.unsplash.com/photo-1551024601-562960f8dbbc?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80" }
        ];

        let currentDate = "2026-02-03";
        const dates = Object.keys(itineraryDB);

        window.onload = function() {
            renderDateNav();
            selectDate(dates[0], 0);
            renderFood();
        };

        function renderDateNav() {
            const container = document.getElementById('dateNav');
            container.innerHTML = "";
            dates.forEach((date, index) => {
                const dayStr = date.split(' ')[1].substring(5);
                const dLabel = `D${index + 1}`;
                const dateKey = date.split(' ')[1].substring(0,10);
                const el = document.createElement('div');
                el.className = 'date-chip';
                el.dataset.date = dateKey;
                if(currentDate === dateKey) el.classList.add('active');
                el.innerHTML = `<strong>${dLabel}</strong><span>${dayStr}</span>`;
                el.onclick = () => selectDate(date, index);
                container.appendChild(el);
            });
        }

        function selectDate(fullKey, index) {
            currentDate = fullKey.split(' ')[1].substring(0,10);
            document.querySelectorAll('.date-chip').forEach(d => d.classList.remove('active'));
            if(document.querySelectorAll('.date-chip')[index]) {
                document.querySelectorAll('.date-chip')[index].classList.add('active');
            }
            renderItinerary(fullKey);
            const weatherDate = fullKey.match(/\d{4}-\d{2}-\d{2}/)[0];
            renderWeather(weatherDate);
        }

        // 核心修正：將「女性走路圖」加入標題後
        // 使用這個穩定的 Flaticon 圖示
        const walkingIconUrl = "https://cdn-icons-png.flaticon.com/512/94/94178.png"; 

        function renderItinerary(key) {
            const list = document.getElementById('itineraryList');
            const items = itineraryDB[key] || [];
            list.innerHTML = "";
            
            items.forEach(item => {
                const imgHtml = item.img ? `<div class="card-img-col"><img src="${item.img}" class="card-img" onerror="this.src='https://placehold.co/150x150?text=No+Image'"></div>` : '';
                
                // 這裡加入了 <img class="walk-icon-inline"> 
                const html = `
                <div class="timeline-item">
                    <div class="time-wrapper">
                        <div class="time-bubble">${item.time}</div>
                    </div>
                    <div class="content-col">
                        ${imgHtml}
                        <div class="card-body">
                            <span class="tag ${item.type}">${item.type}</span>
                            <h3>
                                ${item.title} 
                                <img src="${walkingIconUrl}" class="walk-icon-inline" alt="walk">
                            </h3>
                            <div class="note">${item.note}</div>
                        </div>
                    </div>
                </div>`;
                list.innerHTML += html;
            });
        }

        function renderWeather(dateStr) {
            const data = weatherDB[dateStr] || { temp: "--", tip: "旅途愉快", icon: "smile" };
            document.getElementById('currentDateDisplay').innerText = dateStr;
            document.getElementById('weatherTemp').innerHTML = `<i class="fas fa-${data.icon}" style="margin-right:5px;"></i> ${data.temp}`;
            document.getElementById('weatherTip').innerHTML = `<i class="fas fa-tshirt"></i> <span>${data.tip}</span>`;
        }

        function renderFood() {
            const list = document.getElementById('foodList');
            foodDB.forEach(item => {
                list.innerHTML += `
                <div class="food-card">
                    <img src="${item.img}" class="real-food-img" onerror="this.src='https://placehold.co/300x150?text=Food'">
                    <div class="food-info">
                        <div style="font-weight:bold;">${item.name}</div>
                        <div style="color:var(--accent); font-size:0.9rem;">${item.price} (${item.shop})</div>
                    </div>
                </div>`;
            });
        }

        // 語音修正：增加取消前次發音的功能，提高反應速度
        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel(); // 斷開前一次發音
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ja-JP';
                utterance.rate = 0.9; // 語速適中
                window.speechSynthesis.speak(utterance);
            } else {
                alert("瀏覽器不支援發音");
            }
        }

        function switchPage(pageId, navEl) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${pageId}`).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            navEl.classList.add('active');
        }
    </script>
</body>
</html>
